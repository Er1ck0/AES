> Proceso de cifrando en conjunto con la llave, despues de haber realizado **Key Expansion** ya que es necesaria.

A partir de aqui, el proceso se centra en el texto a cifrar. Sin embargo, es en conjunto con la llave. Como recordatorio, se lista a continuacion:
- "Sh3llr1ck0!123#." => Llave a utilizar.
- "Secret messages." => Texto a cifrar.
Donde la llave expandida es:

<img width="1136" height="201" alt="KeyExpanded" src="https://github.com/user-attachments/assets/20df4355-45f0-40db-8f69-927c5533de27" />


Y el texto a cifrar es:

|     | C0  | C1  | C2  | C3  |     | C0  | C1  | C2  | C3  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| F0  | S   | e   | e   | g   |     | 53  | 65  | 65  | 67  |
| F1  | e   | t   | s   | e   | =>  | 65  | 74  | 73  | 65  |
| F2  | c   |     | s   | s   |     | 63  | 20  | 73  | 73  |
| F3  | r   | m   | a   | .   |     | 72  | 6d  | 61  | 2e  |

---
> SubBytes.
>Sustitucion de cada byte del bloque con otro, la sustitucion se realiza con la tabla <a href="/AES/Proceso/SubBytes/S-Box.png">S-Box</a>

La susticion se realiza tomando los valores 53,65,63,72 y asi, consecutivamente hasta completar el bloque 4x4; realizaremos la busqueda en los ejes X = Filas,Y = Columnas. Para 53, X = 5; Y = 3. Resultando en el valor **ed**.

|     | C0  | C1  | C2  | C3  |     | C0  | C1  | C2  | C3  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| F0  | 53  | 65  | 65  | 67  |     | ed  | 4d  | 4d  | 85  |
| F1  | 65  | 74  | 73  | 65  | =>  | 4d  | 92  | 8f  | 4d  |
| F2  | 63  | 20  | 73  | 73  |     | fb  | b7  | 8f  | 8f  |
| F3  | 72  | 6d  | 61  | 2e  |     | 40  | 3c  | ef  | 31  |

> Shiftrows.
>Cambio de filas (rows).

La primer fila queda intacta. Mientras que, apartir de la segunda fila, tienen una transposicion de n + 1 en sentido izquierto, donde:
- n = 1
- La transposicion comienza a partir de F1.

<img width="454" height="184" alt="ShiftRows" src="https://github.com/user-attachments/assets/6c77387b-8383-4f88-8361-c68c8acfc131" />
<br/><br/>


> MixColumns.
>Operacion GF(2^8).

Mezcla de matrices mediando la operacion booleana XOR; tambien conocido como multiplicacion GF o "**Galois Fiel Multiplication/Division**". GF es la operacion basica para la reduccion de polinomios ya que GF cuenta con un espacio **finito**.

Partamos de lo mas sencillo, la tabla GF y su representacion polinomial.

| Valor GF | Valor Polonial | Valor binario (8 bits) | Valor del exponente |
| -------- | -------------- | ---------------------- | ------------------- |
| 01       | 1              | 0000 0001              | 0                   |
| 02       | x              | 0000 0010              | 1                   |
| 03       | x + 1          | 0000 0011              | 1 + 0               |

*Nota: Las letras "x" son constantes, las cuales tienen un valor exponencial de 2, similar a la conversion binaria.*

---

> Multiplicacion de matrices.

Debido a que nos entamos enfrentando a operaciones entre matrices, en este paso, es importante entender el procedimiento de **multiplicacion** entre matrices:
- La matriz A={123,456,789} y la matriz B={102030,405060,708090}.
- Las posiciones de los elementos de las matrices son entendidas por indices, es decir, [1,1] es el primer elemento 1 = C1F1, [1,2] es el elemento 4 = C1F2 y asi consecutivamente.
- Para obtener el valor de C7F1 = (C1F1 * C4F1) + (C1F2 * C5F1) + (C1F3 * C6F1), lo que es equivalente a C7F1 = (1 * 10) + (3 * 20) + (7 * 30) = 10 + 60 + 210. Por lo tanto, C7F1 = 280.
- El proceso es equivalente para cada posicion.
- Ejemplo:
	- C8F2 = (C2F1 * C4F2) + (C2F2 * C5F2) + (C2F3 * C6F2) = (2 * 20) + (5 * 50) + (8 * 60) = 40 + 250 + 480 = 770.
	- C9F3 = (C3F1 * C4F3) + (C3F2 * C5F3) + (C3F3 * C6F3) = (3 * 70) + (6 * 80) + (9 * 90) = 210 + 480 + 810 = 1500.
	- Proceso repetitivo hasta llenar la matriz resultando.


| F\C | C1  | C2  | C3  |     | C4  | C5  | C6  |     | C7  | C8  | C9   |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | ---- |
| F1  | 1   | 2   | 3   |     | 10  | 20  | 30  |     | 280 |     |      |
| F2  | 4   | 5   | 6   | X   | 40  | 50  | 60  | =   |     | 770 |      |
| F3  | 7   | 8   | 9   |     | 70  | 80  | 90  |     |     |     | 1500 |

---
MixColumns se realiza con ayuda de la tabla <a href="/AES/Proceso/MixColumns/Rijndael's Table.md">Rijndael's Table</a>. Operaciones basadas tanto en multiplicaciones de matrices como GF(2^m).

<img width="461" height="307" alt="GFMultiplied" src="https://github.com/user-attachments/assets/d202769e-3c77-4921-8967-9ab303cd5dd9" />


Explicacion:
- Estamos trabajando con valores exadecimales, por lo tanto tienen un equivalente en binario.
- Donde se ubique un 1, dentro de su formato binario, significa que contine un valor x^m
- Dentro de los valores hexadecimales tenemo que: [1-9 y A-F], donde {A=10,B=11,C=12,D=13,E=14 y F=15}.
- 
| Exponente |     | x^7 | x^6 | x^5 | x^4 |     | x^3 | x^2 | x^1 | x^0 |
| --------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| Entero    |     | 8   | 4   | 2   | 1   |     | 8   | 4   | 2   | 1   |
|           | ed  | 1   | 1   | 1   | 0   |     | 1   | 1   | 0   | 1   |
|           | 02  | 0   | 0   | 0   | 0   |     | 0   | 0   | 1   | 0   |

Para **ed**, tenemos: x^7 + x^6 + x^5 + x^3 + x^2 + 1
Para **02**, tenemos: x^1

Multiplicamos **ed** * **02**, y siguiendo las reglas matematicas, la multiplicacion de dos bases iguales (x) resulta en la misma base pero sumando sus exponentes.

Resultado = x^8 + x^7 + x^6 + x^4 + x^3 + x^1. Sin embargo, GF cuenta con un espacio finito, el cual no puede exceder x^8. Por ende, debemos reducirlo.
- x^8 es equivalente a x^4 + x^3 + x^1 + 1; ya que 4 + 3 + 1 = 8. El 1 final siempre se encuentra presente al hacer este tipo de transformaciones.

| **ed** * **02** = | x^8                 | x^7 | x^6    | x^4    | x^3    | x^1 |     |
| ----------------- | ------------------- | --- | ------ | ------ | ------ | --- | --- |
| Sustitucion       | x^4 + x^3 + x^1 + 1 | x^7 | x^6    | x^4    | x^3    | x^1 |     |
| Agrupamos         | x^7                 | x^6 | 2(x^4) | 2(x^3) | 2(x^1) | 1   |     |
| Resultado         | x^7 + x^6 + 1       |     |        |        |        |     |     |

*Nota: Si hay cantidad impar de x^m, se conserva. Si hay cantidad par de x^m, se elimina.*

x^7 + x^6 + 1 es quivalente a: 1100 0001, que a su vez, es igual a: 12 | 1 => C1.

Entonces, para la posicion [0,0] tenemos lo siguiente:
<br/>
<img width="1140" height="270" alt="0-0" src="https://github.com/user-attachments/assets/0f22b3a4-d0cf-49b2-9fb7-76b77e8495ae" />


Donde es necesario multiplicar cada elemento y posteriormente realizar la operacion **XOR** de los resultados.
<br/>
<img width="362" height="232" alt="Xored-00" src="https://github.com/user-attachments/assets/c9482da2-7682-458b-9f59-0f5816885394" />


Para la posicion [1,1], tenemos lo siguiente:
<br/>
<img width="831" height="182" alt="GFMult1-1" src="https://github.com/user-attachments/assets/90d7adbe-1083-41f5-92fb-9c3f3bdf8c07" />

Como base, tenemos lo siguiente.
<br/>
<img width="626" height="314" alt="base" src="https://github.com/user-attachments/assets/77b33e3d-0ecf-4cf1-9d1a-1e6d2eb25573" />


*Nota: El proceso debe repetirse para cada posicion de la matriz hasta completarla.*

---

> AddRoundKey

Ultimo paso, donde a diferencia de AddRoundKey en la seccion de Key Expansion, unicamente realiza la operacion XOR entre columnas del texto a cifrar y la llave expandida.

Este "Agregado de ronda de llave" sigue los siguientes pasos:
1. Toma la primer columna tanto de la matriz del texto a cifrar, como de la matriz de la llave ya expandida.
2. Realiza operacion XOR entre cada elemento de la matriz del texto a cifrar y su correspondiente con la matriz de la llave expandida.
3. La columna resultando se convertira en la primer columna de una nueva matriz.
Los 3 pasos anteriores deben repetirse hasta adquirir una nueva matriz de 4x4.

<img width="575" height="427" alt="Column1" src="https://github.com/user-attachments/assets/ff4e743e-c1c2-41e8-a944-1b702d0bacf5" />


Matriz final dentro de la primer ronda.

<img width="302" height="239" alt="Round1" src="https://github.com/user-attachments/assets/5a1485bb-f648-404c-aefc-2af15066f60e" />


**Esto significa que, hasta este punto, el cifrado no ha terminado. Al tratarte de AES-128, son necesarias 9 rondas mas. En la decima ronda, el unico paso omitido es MixColumns.**
