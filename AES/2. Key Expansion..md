> Metodo AES-128 .

**Key Expansion:**
Procedimiento encargado de generar **subkeys** para cada ronda denominadas **Round Keys**. Cada ronda de cifrado utiliza una **subkey** unica previamente generada. 
Ya que el proceso de AES puede ser confuso, se utiliza un formato de **words** para simplificar su entendimiento.

**Key Schedule:**
Aqui, cada **word** hace referencia a una unidad de 4 bytes. Por ende, la matriz se compone de 4 **words**, es decir, cada columna de la matriz representa un **word**.

Llave: "Sh3llr1ck0!123#.". 
F = Fila; C = Columna; W = Word.

|     | C0  | C1  | C2  | C3  |
| --- | --- | --- | --- | --- |
| F0  | S   | l   | k   | 2   |
| F1  | h   | r   | 0   | 3   |
| F2  | 3   | 1   | !   | #   |
| F3  | l   | c   | 1   | .   |
|     | W0  | W1  | W2  | W3  |

AES-128 genera un total de 10 rondas, es decir, 44 palabras. Lo que es igual a 44 columnas.
Partiendo de lo anterior planteado, generaremos la sexta **word**.  Sin embargo, **Key Expansion** tambien cuenta con su propio procedimiento, el cual esta compuesto por:
1. **RotWord**: Rotate Word, rotacion de **word**.
2. **SubWord:** Substiture Word. Sustitucion de **word**.
3. **XOR con Wi-n:** Operacion XOR entre Wi (Word en la posicion "i") y Wi-n (Word en la posicion "i-n").
4. **Rcon:** Tabla (<a href="/AES/KeyExpansion/img/KeySchedule/Rcon.md">Rcon</a>) predefinida por el estandar.

*Nota: Debido a que se trata de un procedimiento de cifrado, el cual sera implementado en un lenguaje de programacion, es necesario trabajar en un formato que facilite su entendimiento para la computadora. Por ende, se utilizara el formato hexadecimal.*

| Pos  | 1      | 2      | 3      | 4      |
| ---- | ------ | ------ | ------ | ------ |
| i => | 0      | 1      | 2      | 3      |
|      | **C0** | **C1** | **C2** | **C3** |
| F0   | 53     | 6c     | 6b     | 32     |
| F1   | 68     | 72     | 30     | 33     |
| F2   | 33     | 31     | 21     | 23     |
| F3   | 6c     | 63     | 31     | 2e     |
|      | **W0** | **W1** | **W2** | **W3** |

> RotWord.

Rotacion de palabra (**word**), donde nos ubicaremos en la ultima columna = word. Lo que equivale a **W3**. Posteriormente, desplazaremos su valor equivalente F0C3 a F3C3 y recorremos los valores una posicion arriba.
<br/><br/>
<img width="449" height="289" alt="RotWord" src="https://github.com/user-attachments/assets/6718163e-fabf-4111-9d70-510850eb3f83" />
<br/>

> SubWord.

En este paso, se necesita el uso de la tabla <a href="/AES/Proceso/SubBytes/S-Box.png">S-Box</a> para la sustitucion de valores hexadecimales a su equivalente dentro de la tabla. 
Tomando los valores [33,23,2e,32] correspondientes a la palabra (**word**) previa; realizaremos la busqueda en los ejes X = Filas,Y = Columnas. Para 33, X = 3; Y = 3. Resultando en el valor c3.

<img width="209" height="174" alt="SubWord" src="https://github.com/user-attachments/assets/1a7ac7e6-5e47-440b-9194-6bdc4d096442" />
<br/><br/>

> XOR W(i - n)

Operacion **XOR** entre el resultado anterior y la palabra (**word**) en la posicion i. De tal modo que:
1. Si nos ubicamos en i=3, corresponde a la posicion 4.
2. Con "n" como constante 4.
3. W(i) **XOR** W(i - n), corresponde a, W(4) **XOR** W(4 - 4) => W(4) **XOR** W(0).

<img width="295" height="207" alt="SubW-Xor-Win" src="https://github.com/user-attachments/assets/3713a2b1-27d8-4d49-ad27-e957c09b265c" />
<br/><br/>

> Rcon

Ultimo paso, en el cual se realiza la operacion **XOR** entre la palabra (**word**) previa y la palabra de la tabla <a href="/AES/KeyExpansion/img/KeySchedule/Rcon.md">Rcon</a>, iniciando en la posicion 0, es decir, la primer palabra de dicha tabla.

<img width="262" height="204" alt="Word4" src="https://github.com/user-attachments/assets/af479751-c8b8-46c4-9614-5ffb93f3eebf" />
<br/>

*Nota: A pesar de estar enumeradas W0,W1,W2, W3 la longitud de la matriz sigue siendo 4x4.*

Es decir, el resultado final es la generacion de la palabra (**word**) i + 1. Donde, para la primer ronda, la matriz pasa de 4x4 a 5x4

| Pos  | 1   | 2   | 3   | 4   | 5      | ... | 8      | ... | **12**  | ... | **16**  | ... | **20**  | ... | **24**  | ... | **28**  | ... | **32**  | ... | **36**  | ... | **40**  |
| ---- | --- | --- | --- | --- | ------ | --- | ------ | --- | ------- | --- | ------- | --- | ------- | --- | ------- | --- | ------- | --- | ------- | --- | ------- | --- | ------- |
| i => | 0   | 1   | 2   | 3   | 4      | ... | 8      | ... | **12**  | ... | **16**  | ... | **20**  | ... | **24**  | ... | **28**  | ... | **32**  | ... | **36**  | ... | **40**  |
|      | C0  | C1  | C2  | C3  | **C4** |     |        |     |         |     |         |     |         |     |         |     |         |     |         |     |         |     |         |
| F0   | 53  | 6c  | 6b  | 32  | **91** |     |        |     |         |     |         |     |         |     |         |     |         |     |         |     |         |     |         |
| F1   | 68  | 72  | 30  | 33  | **4e** |     |        |     |         |     |         |     |         |     |         |     |         |     |         |     |         |     |         |
| F2   | 33  | 31  | 21  | 23  | **02** |     |        |     |         |     |         |     |         |     |         |     |         |     |         |     |         |     |         |
| F3   | 6c  | 63  | 31  | 2e  | **4f** |     |        |     |         |     |         |     |         |     |         |     |         |     |         |     |         |     |         |
|      | W0  | W1  | W2  | W3  | **W4** | ..  | **W8** | ..  | **W12** | ... | **W16** | ... | **W20** | ... | **W24** | ... | **W28** | ... | **W32** | ... | **W36** | ... | **W40** |

*Nota 2: Unicamente se realizaran estos cuatro pasos cada que se inicie un nuevo bloque. Los bloques se componene de 4 palabras, eso quiere decir, que en para las palabras W4, W8,W12, W16, W20, W24, W28, W32, W36, W40 se realizaran las operaciones **RotWord**, **SubWord**, **Xor W(i-n)** y **Rcon**.*

---

> Complemento de la matriz.

Aqui se cubrira el proceso de llenado de la matriz para las palabras (**words**) faltantes [5-7], [9-11], [13-15], [17-19], [21-23], [25-27], [29-31], [33-35], [37-39] y [41-44].

Este proceso es mas sencillo y reducido en comparacion con el inicio de un nuevo bloque ya que unicamente consta de:
- **W(i) XOR W(i - n).**

Donde, nuevamente, "i" es el inidice en el que nos ubicamos y "n" tiene un valor constante de 4. De tal modo que:
1. Si nos ubicamos en i=4, corresponde a la posicion 5.
2. Con "n" como constante 4.
3. W(i) **XOR** W(i - n), corresponde a, W(5) **XOR** W(5 - 4) => W(5) **XOR** W(1).
<br/>
<img width="441" height="204" alt="Word5" src="https://github.com/user-attachments/assets/229e09d8-0323-493e-86f7-f02f566538b7" />
<br/><br/>

| Pos  | 1   | 2   | 3   | 4   | 5      | 6   |
| ---- | --- | --- | --- | --- | ------ | --- |
| i => | 0   | 1   | 2   | 3   | 4      | 5   |
|      | C0  | C1  | C2  | C3  | **C4** | C5  |
| F0   | 53  | 6c  | 6b  | 32  | **91** | fd  |
| F1   | 68  | 72  | 30  | 33  | **4e** | 3c  |
| F2   | 33  | 31  | 21  | 23  | **02** | 33  |
| F3   | 6c  | 63  | 31  | 2e  | **4f** | 2c  |
|      | W0  | W1  | W2  | W3  | **W4** | W5  |

Proceso seguido consecutivamente hasta el inicio de un nuevo bloque, donde se aplica el proceso inicial de RotWord, SubWord, XOR W(i - n) y Rcon.

---

Recordando que se realizan un total de 10 rondas, los resultados deberian de ser los siguientes.

De ronda 1 a ronda 5:
<br/><br/>
<img width="822" height="180" alt="Rounds1-5" src="https://github.com/user-attachments/assets/4bd38386-2479-4f80-b71f-ff4e07afe501" />
<br/><br/>

De ronda 6 a ronda 10:
<br/><br/>
<img width="731" height="187" alt="Rounds6-10" src="https://github.com/user-attachments/assets/eace8f49-280c-46ff-ad51-8d84d696db95" />
<br/><br/>

Resultado final:
<br/><br/>
<img width="1552" height="339" alt="FinalKeySchedule" src="https://github.com/user-attachments/assets/05e06d39-652a-4573-a08c-689c8a68b0c4" />
<br/><br/>
